version: '3.7'
services:
    # Update this to the name of the service you want to work with in your docker-compose.yml file
    discord-2000:
        container_name: 'discord-2000'

        # If you want add a non-root user to your Dockerfile, you can use the "remoteUser"
        # property in devcontainer.json to cause VS Code its sub-processes (terminals, tasks,
        # debugging) to execute as the user. Uncomment the next line if you want the entire
        # container to run as this user instead. Note that, on Linux, you may need to
        # ensure the UID and GID of the container user you create matches your local user.
        # See https://aka.ms/vscode-remote/containers/non-root for details.
        user: node

        build:
            context: ..
            dockerfile: .devcontainer/Dockerfile

        environment:
            - token=${token}
            - cmdPrefix=${cmdPrefix}
            - presence_text_channel_updates=${presence_text_channel_updates}
            - enable_presence_updates=${enable_presence_updates}
            - timezone=${timezone}
            - postgres_db=${postgres_db}
            - postgres_user=${postgres_user}
            - postgres_password=${postgres_password}
            - postgres_host=${postgres_host}
            - NODE_ENV=development

        volumes:
            # Update this to wherever you want VS Code to mount the folder of your project
            - ../:/workspace:cached,Z

        network_mode: host

        # Overrides default command so things don't shut down after the process ends.
        command: /bin/sh -c "while sleep 1000; do :; done"

    postgres:
        container_name: 'postgres'
        image: postgres:13.1
        restart: unless-stopped
        environment:
            - POSTGRES_USER=${postgres_user}
            - POSTGRES_PASSWORD=${postgres_password}
            - POSTGRES_DB=${postgres_db}
            - PGDATA=/var/lib/postgresql/data/pgdata
        volumes:
            - ${PWD}/postgres/init-db.sh:/docker-entrypoint-initdb.d/init-db.sh
            - postgres:/var/lib/postgresql/data
        ports:
            - 5432:5432

volumes:
    postgres:
